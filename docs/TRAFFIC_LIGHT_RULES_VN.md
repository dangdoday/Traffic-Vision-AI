# Luáº­t Giao ThÃ´ng Viá»‡t Nam - ÄÃ¨n TÃ­n Hiá»‡u

## ğŸ“‹ Luáº­t ChÃ­nh Thá»©c (Theo Nghá»‹ Ä‘á»‹nh 100/2019/NÄ-CP vÃ  ThÃ´ng tÆ° 65/2015/TT-BGTVT)

### 1. ÄÃˆN TRÃ’N (ÄÃ¨n 3 mÃ u cÆ¡ báº£n)

| MÃ u ÄÃ¨n | Äi Tháº³ng | Ráº½ TrÃ¡i | Ráº½ Pháº£i | Ghi ChÃº |
|---------|----------|---------|---------|---------|
| ğŸŸ¢ XANH | âœ… ÄÆ°á»£c phÃ©p | âœ… ÄÆ°á»£c phÃ©p (náº¿u KHÃ”NG cÃ³ Ä‘Ã¨n ráº½ trÃ¡i riÃªng) | âœ… ÄÆ°á»£c phÃ©p (náº¿u KHÃ”NG cÃ³ Ä‘Ã¨n ráº½ pháº£i riÃªng) | ÄÆ°á»£c Ä‘i táº¥t cáº£ hÆ°á»›ng náº¿u khÃ´ng cÃ³ Ä‘Ã¨n chuyÃªn biá»‡t |
| ğŸŸ¡ VÃ€NG | âš ï¸ Dá»«ng láº¡i (trá»« khi Ä‘Ã£ quÃ¡ gáº§n khÃ´ng dá»«ng Ä‘Æ°á»£c) | âš ï¸ Dá»«ng láº¡i | âš ï¸ Dá»«ng láº¡i | Chuáº©n bá»‹ dá»«ng |
| ğŸ”´ Äá» | âŒ Cáº¤M | âŒ Cáº¤M | âš ï¸ **Ráº¼ PHáº¢I ÄÆ¯á»¢C PHÃ‰P SAU KHI Dá»ªNG** (Äiá»u 7, ThÃ´ng tÆ° 65/2015) | **LÆ°u Ã½ Ä‘áº·c biá»‡t vá» ráº½ pháº£i** |

### 2. ÄÃˆN Ráº¼ PHáº¢I CHUYÃŠN BIá»†T (MÅ©i tÃªn ráº½ pháº£i)

| MÃ u ÄÃ¨n | Ráº½ Pháº£i | Ghi ChÃº |
|---------|---------|---------|
| ğŸŸ¢ XANH | âœ… ÄÆ°á»£c phÃ©p | Ráº½ pháº£i an toÃ n |
| ğŸ”´ Äá» | âš ï¸ **Ráº¼ PHáº¢I ÄÆ¯á»¢C PHÃ‰P SAU KHI Dá»ªNG** | Theo Äiá»u 7, ThÃ´ng tÆ° 65/2015/TT-BGTVT |

**Äiá»u 7 - ThÃ´ng tÆ° 65/2015/TT-BGTVT:**
> "Táº¡i cÃ¡c giao lá»™ cÃ³ tÃ­n hiá»‡u Ä‘Ã¨n, ngÆ°á»i Ä‘iá»u khiá»ƒn phÆ°Æ¡ng tiá»‡n Ä‘Æ°á»£c ráº½ pháº£i theo hÆ°á»›ng mÅ©i tÃªn mÃ u Ä‘á» nhÆ°ng pháº£i dá»«ng láº¡i trÆ°á»›c váº¡ch dá»«ng xe hoáº·c trÆ°á»›c Ä‘Æ°á»ng ngÆ°á»i Ä‘i bá»™ qua Ä‘Æ°á»ng vÃ  chá»‰ Ä‘Æ°á»£c Ä‘i khi khÃ´ng gÃ¢y trá»Ÿ ngáº¡i cho phÆ°Æ¡ng tiá»‡n vÃ  ngÆ°á»i Ä‘i bá»™ Ä‘ang Ä‘i theo tÃ­n hiá»‡u Ä‘Ã¨n xanh."

### 3. ÄÃˆN Ráº¼ TRÃI CHUYÃŠN BIá»†T (MÅ©i tÃªn ráº½ trÃ¡i)

| MÃ u ÄÃ¨n | Ráº½ TrÃ¡i | Ghi ChÃº |
|---------|---------|---------|
| ğŸŸ¢ XANH | âœ… ÄÆ°á»£c phÃ©p | Ráº½ trÃ¡i an toÃ n |
| ğŸ”´ Äá» | âŒ Cáº¤M | **KHÃ”NG** Ä‘Æ°á»£c ráº½ trÃ¡i khi Ä‘Ã¨n Ä‘á» |

**LÆ°u Ã½:** KhÃ´ng giá»‘ng ráº½ pháº£i, **Ráº¼ TRÃI KHI ÄÃˆN Äá» LÃ€ NGHIÃŠM Cáº¤M**

### 4. ÄÃˆN ÄI THáº²NG CHUYÃŠN BIá»†T (MÅ©i tÃªn tháº³ng)

| MÃ u ÄÃ¨n | Äi Tháº³ng | Ghi ChÃº |
|---------|----------|---------|
| ğŸŸ¢ XANH | âœ… ÄÆ°á»£c phÃ©p | |
| ğŸ”´ Äá» | âŒ Cáº¤M | |

---

## ğŸ” So SÃ¡nh Logic Hiá»‡n Táº¡i vs Luáº­t VN

### âš ï¸ Váº¤N Äá»€ PHÃT HIá»†N TRONG CODE:

#### 1. **Ráº¼ PHáº¢I KHI ÄÃˆN Äá»** - SAI LUáº¬T VN âŒ

**Code hiá»‡n táº¡i:**
```python
elif (tl_type == 'ráº½ pháº£i' and vehicle_direction == 'right'):
    has_matching_red_arrow = True  # âŒ Coi lÃ  vi pháº¡m
```

**Luáº­t VN thá»±c táº¿:**
- Ráº½ pháº£i khi Ä‘Ã¨n Ä‘á» **ÄÆ¯á»¢C PHÃ‰P** náº¿u:
  - Xe Ä‘Ã£ dá»«ng hoÃ n toÃ n trÆ°á»›c váº¡ch dá»«ng
  - KhÃ´ng gÃ¢y cáº£n trá»Ÿ xe Ä‘i tháº³ng/trÃ¡i
  - KhÃ´ng cÃ³ biá»ƒn cáº¥m ráº½ pháº£i khi Ä‘Ã¨n Ä‘á»

**âŒ Logic hiá»‡n táº¡i SAI:** Coi ráº½ pháº£i khi Ä‘Ã¨n Ä‘á» lÃ  vi pháº¡m

#### 2. **Ráº¼ PHáº¢I KHI ÄÃˆN TRÃ’N Äá»** - SAI LUáº¬T VN âŒ

**Code hiá»‡n táº¡i:**
```python
if tl_type == 'trÃ²n':  # Circular red = all directions forbidden
    has_matching_red_arrow = True  # âŒ Cáº¥m táº¥t cáº£ hÆ°á»›ng
```

**Luáº­t VN thá»±c táº¿:**
- ÄÃ¨n trÃ²n Ä‘á»: Cáº¤M Ä‘i tháº³ng vÃ  ráº½ trÃ¡i
- ÄÃ¨n trÃ²n Ä‘á»: Ráº¼ PHáº¢I VáºªN ÄÆ¯á»¢C PHÃ‰P (sau khi dá»«ng)

**âŒ Logic hiá»‡n táº¡i SAI:** Cáº¥m ráº½ pháº£i khi Ä‘Ã¨n trÃ²n Ä‘á»

#### 3. **Ráº¼ TRÃI KHI ÄÃˆN XANH** - ÄÃšNG âœ…

**Code hiá»‡n táº¡i:**
```python
elif (tl_type == 'Ä‘i tháº³ng' and vehicle_direction == 'left' and not has_left_turn_light):
    # Xe ráº½ trÃ¡i khi Ä‘Ã¨n tháº³ng xanh CHá»ˆ OK náº¿u KHÃ”NG CÃ“ Ä‘Ã¨n ráº½ trÃ¡i riÃªng
    has_matching_green_arrow = True
```

**Luáº­t VN:** âœ… ÄÃšNG - Ráº½ trÃ¡i Ä‘Æ°á»£c phÃ©p khi Ä‘Ã¨n tháº³ng/trÃ²n xanh (náº¿u khÃ´ng cÃ³ Ä‘Ã¨n ráº½ trÃ¡i riÃªng)

---

## ğŸ› ï¸ LOGIC ÄÃšNG Cáº¦N Sá»¬A

### Ma Tráº­n Quyáº¿t Äá»‹nh ÄÃºng Theo Luáº­t VN:

| TÃ¬nh Huá»‘ng | HÆ°á»›ng Xe | Loáº¡i ÄÃ¨n | MÃ u ÄÃ¨n | Káº¿t Quáº£ | LÃ½ Do |
|------------|----------|----------|---------|---------|-------|
| 1 | Tháº³ng | TrÃ²n | Äá» | âŒ VI PHáº M | Cáº¥m Ä‘i tháº³ng |
| 2 | Tháº³ng | TrÃ²n | Xanh | âœ… OK | ÄÆ°á»£c Ä‘i tháº³ng |
| 3 | Tháº³ng | Äi tháº³ng | Äá» | âŒ VI PHáº M | ÄÃ¨n tháº³ng Ä‘á» cáº¥m Ä‘i tháº³ng |
| 4 | Tháº³ng | Äi tháº³ng | Xanh | âœ… OK | ÄÆ°á»£c Ä‘i tháº³ng |
| 5 | TrÃ¡i | TrÃ²n | Äá» | âŒ VI PHáº M | Cáº¥m ráº½ trÃ¡i |
| 6 | TrÃ¡i | TrÃ²n | Xanh | âœ… OK (náº¿u khÃ´ng cÃ³ Ä‘Ã¨n ráº½ trÃ¡i) | ÄÆ°á»£c ráº½ trÃ¡i |
| 7 | TrÃ¡i | Äi tháº³ng | Äá» | âŒ VI PHáº M | ÄÃ¨n tháº³ng Ä‘á» cáº¥m ráº½ trÃ¡i |
| 8 | TrÃ¡i | Äi tháº³ng | Xanh | âœ… OK (náº¿u khÃ´ng cÃ³ Ä‘Ã¨n ráº½ trÃ¡i) | ÄÆ°á»£c ráº½ trÃ¡i |
| 9 | TrÃ¡i | Ráº½ trÃ¡i | Äá» | âŒ VI PHáº M | ÄÃ¨n ráº½ trÃ¡i Ä‘á» cáº¥m ráº½ trÃ¡i |
| 10 | TrÃ¡i | Ráº½ trÃ¡i | Xanh | âœ… OK | ÄÆ°á»£c ráº½ trÃ¡i |
| 11 | **Pháº£i** | **TrÃ²n** | **Äá»** | âš ï¸ **OK** (náº¿u Ä‘Ã£ dá»«ng) | **Ráº½ pháº£i Ä‘Æ°á»£c phÃ©p** |
| 12 | Pháº£i | TrÃ²n | Xanh | âœ… OK | ÄÆ°á»£c ráº½ pháº£i |
| 13 | **Pháº£i** | **Äi tháº³ng** | **Äá»** | âš ï¸ **OK** (náº¿u Ä‘Ã£ dá»«ng) | **ÄÃ¨n tháº³ng khÃ´ng cáº¥m ráº½ pháº£i** |
| 14 | Pháº£i | Äi tháº³ng | Xanh | âœ… OK | ÄÆ°á»£c ráº½ pháº£i |
| 15 | **Pháº£i** | **Ráº½ pháº£i** | **Äá»** | âš ï¸ **OK** (náº¿u Ä‘Ã£ dá»«ng) | **Ráº½ pháº£i Ä‘Æ°á»£c phÃ©p** |
| 16 | Pháº£i | Ráº½ pháº£i | Xanh | âœ… OK | ÄÆ°á»£c ráº½ pháº£i |

### âš ï¸ LÆ°u Ã Vá» "Ráº½ Pháº£i Khi ÄÃ¨n Äá»":

**Thá»±c táº¿ táº¡i Viá»‡t Nam:**
- Camera giÃ¡m sÃ¡t thÆ°á»ng **KHÃ”NG** pháº¡t ráº½ pháº£i khi Ä‘Ã¨n Ä‘á» náº¿u xe Ä‘Ã£ dá»«ng
- Chá»‰ pháº¡t náº¿u:
  - Xe khÃ´ng dá»«ng trÆ°á»›c váº¡ch
  - Xe cáº¯t ngang lÃ m cáº£n trá»Ÿ xe khÃ¡c
  - CÃ³ biá»ƒn bÃ¡o "Cáº¥m ráº½ pháº£i khi Ä‘Ã¨n Ä‘á»"

**Khuyáº¿n nghá»‹ cho há»‡ thá»‘ng:**
1. **Option 1 (Khuyáº¿n nghá»‹):** KhÃ´ng coi ráº½ pháº£i khi Ä‘Ã¨n Ä‘á» lÃ  vi pháº¡m (theo luáº­t VN)
2. **Option 2:** ThÃªm cá» cáº¥u hÃ¬nh `STRICT_MODE` Ä‘á»ƒ báº­t/táº¯t pháº¡t ráº½ pháº£i khi Ä‘Ã¨n Ä‘á»
3. **Option 3:** Kiá»ƒm tra xe cÃ³ dá»«ng trÆ°á»›c váº¡ch khÃ´ng (phá»©c táº¡p hÆ¡n)

---

## ğŸ“ Code Cáº§n Sá»­a

### File: `integrated_main.py` - Function `check_tl_violation()`

#### Sá»­a 1: Cho phÃ©p ráº½ pháº£i khi Ä‘Ã¨n Ä‘á» (Táº¤T Cáº¢ loáº¡i Ä‘Ã¨n)
```python
# ÄÃ¨n trÃ²n Ä‘á» + ráº½ pháº£i = OK
if tl_type == 'trÃ²n':
    if vehicle_direction == 'right':
        pass  # âœ… KhÃ´ng vi pháº¡m
    else:
        has_matching_red_arrow = True

# ÄÃ¨n Ä‘i tháº³ng Ä‘á»
elif tl_type == 'Ä‘i tháº³ng':
    if vehicle_direction == 'straight':
        has_matching_red_arrow = True  # âŒ Cáº¥m Ä‘i tháº³ng
    elif vehicle_direction == 'left':
        if not has_left_turn_light:
            has_matching_red_arrow = True  # âŒ Cáº¥m ráº½ trÃ¡i
    elif vehicle_direction == 'right':
        if not has_right_turn_light:
            pass  # âœ… Ráº½ pháº£i OK
            
# ÄÃ¨n ráº½ pháº£i Ä‘á» + ráº½ pháº£i = OK
elif (tl_type == 'ráº½ pháº£i' and vehicle_direction == 'right'):
    pass  # âœ… KhÃ´ng vi pháº¡m
    
# ÄÃ¨n ráº½ trÃ¡i Ä‘á» + ráº½ trÃ¡i = VI PHáº M
elif (tl_type == 'ráº½ trÃ¡i' and vehicle_direction == 'left'):
    has_matching_red_arrow = True  # âŒ Vi pháº¡m
```

#### Sá»­a 2: Xá»­ lÃ½ Ä‘Ãºng tá»«ng loáº¡i Ä‘Ã¨n vá»›i tá»«ng hÆ°á»›ng
```python
# ÄÃˆN XANH - Táº¥t cáº£ OK (vá»›i Ä‘iá»u kiá»‡n Ä‘Ã¨n chuyÃªn biá»‡t)
if tl_type == 'trÃ²n' and current_color == 'xanh':
    # Náº¿u khÃ´ng cÃ³ Ä‘Ã¨n chuyÃªn biá»‡t â†’ Táº¥t cáº£ hÆ°á»›ng OK
    if vehicle_direction == 'left' and not has_left_turn_light:
        has_matching_green_arrow = True
    elif vehicle_direction == 'right' and not has_right_turn_light:
        has_matching_green_arrow = True
    elif vehicle_direction == 'straight':
        has_matching_green_arrow = True

# ÄÃˆN ÄI THáº²NG XANH - Äi tháº³ng OK, ráº½ trÃ¡i/pháº£i OK náº¿u khÃ´ng cÃ³ Ä‘Ã¨n riÃªng
if tl_type == 'Ä‘i tháº³ng' and current_color == 'xanh':
    if vehicle_direction == 'straight':
        has_matching_green_arrow = True
    elif vehicle_direction == 'left' and not has_left_turn_light:
        has_matching_green_arrow = True
    elif vehicle_direction == 'right' and not has_right_turn_light:
        has_matching_green_arrow = True
```

---

## ğŸ¯ Káº¿t Luáº­n

### Logic Hiá»‡n Táº¡i:
- âœ… **ÄÃšNG:** Ráº½ trÃ¡i khi Ä‘Ã¨n xanh (khÃ´ng cÃ³ Ä‘Ã¨n ráº½ trÃ¡i riÃªng)
- âœ… **ÄÃšNG:** Cho phÃ©p ráº½ pháº£i khi Ä‘Ã¨n Ä‘á» (táº¥t cáº£ loáº¡i Ä‘Ã¨n)
- âœ… **ÄÃšNG:** Cáº¥m Ä‘i tháº³ng khi Ä‘Ã¨n tháº³ng Ä‘á»
- âœ… **ÄÃšNG:** Cáº¥m ráº½ trÃ¡i khi Ä‘Ã¨n trÃ²n/tháº³ng Ä‘á»
- âœ… **ÄÃšNG:** ÄÃ¨n Ä‘i tháº³ng Ä‘á» KHÃ”NG cáº¥m ráº½ pháº£i

### ÄÃ£ Sá»­a:
1. âœ… **Cho phÃ©p ráº½ pháº£i khi Ä‘Ã¨n ráº½ pháº£i Ä‘á»**
2. âœ… **Cho phÃ©p ráº½ pháº£i khi Ä‘Ã¨n trÃ²n Ä‘á»**
3. âœ… **Cho phÃ©p ráº½ pháº£i khi Ä‘Ã¨n Ä‘i tháº³ng Ä‘á»** (NEW)
4. âœ… **Cáº¥m Ä‘i tháº³ng khi Ä‘Ã¨n Ä‘i tháº³ng/trÃ²n Ä‘á»**
5. âœ… **Cáº¥m ráº½ trÃ¡i khi Ä‘Ã¨n ráº½ trÃ¡i/trÃ²n/tháº³ng Ä‘á»**

### Tham Kháº£o PhÃ¡p LÃ½:
- Nghá»‹ Ä‘á»‹nh 100/2019/NÄ-CP (sá»­a Ä‘á»•i 123/2021/NÄ-CP)
- ThÃ´ng tÆ° 65/2015/TT-BGTVT - Äiá»u 7
- Luáº­t Giao thÃ´ng Ä‘Æ°á»ng bá»™ 2008 (sá»­a Ä‘á»•i 2012, 2018)
